BBPATH .= ":${LAYERDIR}"

BBFILES += "\
            ${LAYERDIR}/recipes-*/*/*.bb \
            ${LAYERDIR}/recipes-*/*/*.bbappend \
           "

BBFILE_COLLECTIONS += "wpe-ml-layer"
BBFILE_PATTERN_wpe-ml-layer := "^${LAYERDIR}/"
BBFILE_PRIORITY_wpe-ml-layer = "20"

LAYERSERIES_COMPAT_wpe-ml-layer = "morthy sumo thud warrior zeus dunfell gatesgarth"

LAYERDEPENDS_wpe-ml-layer = " wpe-layer"

BBFILES_DYNAMIC += " \
    raspberrypi:${LAYERDIR}/dynamic-layers/recipes-*/*/*.bb \
    raspberrypi:${LAYERDIR}/dynamic-layers/recipes-*/*/*.bbappend \
"

LICENSE_PATH += "${LAYERDIR}/licenses"

# WPE needs mpg123 gstreamer plugin
LICENSE_FLAGS_WHITELIST += "commercial_mpg123"
LICENSE_FLAGS_WHITELIST += "commercial_gstreamer1.0-plugins-ugly"

LICENSE_FLAGS_WHITELIST += "${@bb.utils.contains('MACHINE_FEATURES', 'vc4graphics', 'commercial_gstreamer1.0-libav', '', d)}"

# WPE needs gstreamer plugins that need faad2
LICENSE_FLAGS_WHITELIST += "commercial_faad2"

# WPE on rpi needs the OpenMAX gstreamer plugin 
LICENSE_FLAGS_WHITELIST += "commercial_libomxil" 
LICENSE_FLAGS_WHITELIST += "commercial_gstreamer1.0-omx"

PREFERRED_VERSION_wpewebkit = "2.22%"
PREFERRED_VERSION_libwpe = "1.0.0%"
PREFERRED_VERSION_wpebackend-rdk = "git%"

PREFERRED_VERSION_icu = "65.%"
PREFERRED_PROVIDER_virtual/wpebackend = "wpebackend-rdk"

# enable wayland-egl for rpi
PACKAGECONFIG_append_pn-userland += " wayland"
